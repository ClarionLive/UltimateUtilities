#TEMPLATE(UltimatePlaceholder,'Ultimate Placeholder by ClarionLive - Version:1.01'),FAMILY('ABC'),FAMILY('Clarion'),FAMILY('cw20')
#!------------------------------------------------------------------------------
#! Copyright (c) by ClarionLive - www.clarionlive.com - Free to use, sell, ship, whatever
   #Include('cape01.tpw')
   #Include('cape02.tpw')
#!------------------------------------------------------------------------------   
#GROUP(%ReadGlobal,%pa,%force)
  #INSERT(%SetFamily)
  #INSERT(%ReadClassesPR,'UltimatePlaceholderClass.inc',%pa,%force)  
#!------------------------------------------------------------------------------   
#SYSTEM
  #equate(%PlaceholderTPLVersion,'1.00')
#!------------------------------------------------------------------------------   
#Extension(ActivatePlaceholder,'Activate Ultimate Placeholder - Version: 1.00'),APPLICATION
  #Sheet
    #Tab('General')
      #Boxed
        #Display('Ultimate Placeholder')
        #Display('Version ' & %PlaceholderTPLVersion)
        #Display('Copyright © 2014 by ClarionLive')
        #Display('www.clarionlive.com')
      #EndBoxed
      #Display()
      #Boxed('Debugging')
        #Prompt('Disable All Placeholder Features',Check),%DisablePlaceholder,At(10,,172)
      #EndBoxed
      #BOXED,WHERE(%DisablePlaceholder=0)
        #PROMPT('Use only when local template is also present',CHECK),%PlaceholderOnlyWithLocal,AT(10,,172)
      #ENDBOXED
    #EndTab
    #Tab('Multi-Dll'),Where(%DisablePlaceholder=0)
      #Prompt('This is part of a Multi-DLL program',Check),%MultiDLL,default(%ProgramExtension='DLL'),at(10)
      #Enable(%MultiDLL=1)
        #Enable(%ProgramExtension='DLL')
          #Prompt('Export Class from this DLL',Check),%RootDLL,at(10)
        #EndEnable
      #EndEnable
    #EndTab
    #TAB('Classes'),Where(%DisablePlaceholder=0)
      #Insert(%GlobalDeclareClassesPR)
    #ENDTAB
  #EndSheet
#!------------------------------------------------------------------------------
#ATStart
  #CALL(%PlaceholderDeclareGlobalSymbols)
  #IF(%DisablePlaceholder = 0)
    #INSERT(%ReadGlobal,2,0)
  #ENDIF
#ENDAT
#!------------------------------------------------------------------------------
#ATEND
 #IF(%DisablePlaceholder = 0)
   #INSERT(%EndGlobal)
 #ENDIF
#ENDAT
#!------------------------------------------------------------------------------
#AT(%AfterGlobalIncludes),Where(%DisablePlaceholder=0)
INCLUDE('UltimatePlaceholderClass.Inc'),ONCE  ! generated by Placeholder Template
#ENDAT
#!------------------------------------------------------------------------------
#AT(%DllExportList),Where(%programextension = 'DLL' and %RootDLL=1 and %MultiDll=1 and %DisablePlaceholder=0)
#insert(%ExportClassesPR,'UltimatePlaceholderClass.Inc')
#ENDAT
#!------------------------------------------------------------------------------
#AT(%CustomGlobalDeclarations),where(%DisablePlaceholder=0)
#INSERT(%Defines,1,'_UltimatePlaceholderLinkMode_','_UltimatePlaceholderDLLMode_',%MultiDLL,%RootDll)
#ENDAT
#!------------------------------------------------------------------------------
#AT(%mpDefineAll),where(%DisablePlaceholder=0)
#INSERT(%Defines,2,'_UltimatePlaceholderLinkMode_','_UltimatePlaceholderDLLMode_',%MultiDLL,%RootDll)
#ENDAT
#!------------------------------------------------------------------------------
#AT(%mpDefineAll7),where(%DisablePlaceholder=0)
#INSERT(%Defines,3,'_UltimatePlaceholderLinkMode_','_UltimatePlaceholderDLLMode_',%MultiDLL,%RootDll)
#ENDAT
#!------------------------------------------------------------------------------
#AT(%BeforeGlobalIncludes) ,Where(%DisablePlaceholder=0)
Placeholder:TemplateVersion equate('%PlaceholderTPLVersion')
#ENDAT		
#!------------------------------------------------------------------------------
#! The following #ATs occur for each procedure
#!------------------------------------------------------------------------------
#AT(%GatherSymbols),PRIORITY(1000),Where(%DisablePlaceholder=0)
  #CALL(%PlaceholderGatherSymbols1)
#ENDAT
#!------------------------------------------------------------------------------
#AT(%GatherSymbols),PRIORITY(3000),Where(%DisablePlaceholder=0)
  #CALL(%PlaceholderGatherSymbols3)
#ENDAT
#!------------------------------------------------------------------------------
#AT(%LocalDataClasses) ,Where(%DisablePlaceholder=0)
#INSERT(%PlaceholderLocalObject)
#ENDAT
#!------------------------------------------------------------------------------
#AT(%DataSectionAfterWindow),where(%DisablePlaceholder=0)
  #CALL(%SetFamily)
  #IF(%Family = 'cw20' and %cwversion <= 6000)
#INSERT(%PlaceholderLocalObject)
  #ENDIF
#EndAt
#!------------------------------------------------------------------------------
#AT(%DataSection),where(%ProcedureTemplate = 'Source' and %DisablePlaceholder=0)
  #CALL(%SetFamily)
  #IF(%Family = 'cw20' or  %cwversion < 7000)
#INSERT(%PlaceholderLocalObject)
  #ENDIF
#EndAt
#!------------------------------------------------------------------------------
#AT(%LocalProcedures),Where(%DisablePlaceholder=0)
#INSERT(%PlaceholderLocalMethods)
#ENDAT
#!#!------------------------------------------------------------------------------
#!#AT(%dMethodCodeSection,%ActiveTemplate & %ActiveTemplateInstance,%eMethodID),priority(5000),DESCRIPTION('Parent Call')
#!#INSERT(%ParentCall)
#!#ENDAT
#!------------------------------------------------------------------------------
#AT(%WindowManagerMethodCodeSection,'Init','(),BYTE'),PRIORITY(8060),Where(%DisablePlaceholder=0),Description('Ultimate Placeholder Init')
#INSERT(%PlaceholderLocalInitWindow, 'UltimatePlaceholder')
#!#INSERT(%PlaceholderLocalInitWindow, %ObjectName)
#ENDAT
#!------------------------------------------------------------------------------
#AT(%WindowManagerMethodCodeSection,'TakeEvent','(),BYTE'),Priority(6000),where(%DisablePlaceholder=0)
#!%ObjectName.TakeEvent()
UltimatePlaceholder.TakeEvent()
#ENDAT
#!------------------------------------------------------------------------------
#AT(%WindowEventHandling,'OPENWINDOW'),PRIORITY(8060),Where(%DisablePlaceholder=0),Description('Ultimate Placeholder Init')
#INSERT(%PlaceholderLocalInitWindow, 'UltimatePlaceholder')
#!#INSERT(%PlaceholderLocalInitWindow, %ObjectName)
#ENDAT
#!------------------------------------------------------------------------------
#AT(%AcceptLoopBeforeEventHandling),Priority(6000),where(%DisablePlaceholder=0)
#IF(ITEMS(%PlaceholderControl))
UltimatePlaceholder.TakeEvent()
#ENDIF
#ENDAT
#!------------------------------------------------------------------------------
#!#################################################################################################
#! End of GLOBAL EXTENSION
#!#################################################################################################
#Extension(LocalPlaceholder,'Local Placeholder Object'),Procedure,REQ(ActivatePlaceholder(UltimatePlaceholder)),DESCRIPTION('[UltimatePlaceholder] Local Placeholder Support')
  #Sheet
    #Prepare
      #INSERT(%ReadGlobal,3,0)
    #EndPrepare
    #Tab('General')
      #Prompt('Disable this template',Check),%DisableThisPlaceholder,default(0),at(10)
    #EndTab
    #Tab('Settings'),WHERE(~%DisableThisPlaceholder)
      #PROMPT('Automatically do all applicable controls',CHECK),%AutoAddAllPlaceholders,AT(10,,172)
      #DISPLAY
      #BUTTON('Control Overrides'),MULTI(%OverrideControls,%OverrideControlDescription()),INLINE
        #PROMPT('Control:',FROM(%Control,%ControlNeedsPlaceholder())),%OverrideControl,REQ
        #PROMPT('Do not add placeholder to this control',CHECK),%OverrideControlBlocked,AT(10,,172)
        #ENABLE(NOT %OverrideControlBlocked)
          #PROMPT('Optional Text:',EXPR),%OverrideControlText
        #ENDENABLE
      #ENDBUTTON
    #EndTab
#!    #Tab('Class'),WHERE(~%DisableThisPlaceholder)
#!      #Prompt('Object Name:',@s255),%ObjectName,default('UltimatePlaceholderWindow'),at(50,5,110,),promptat(10,5)
#!      #Prompt('Class Name:',@S255),%ClassName,default('UltimatePlaceholderWindowClass')
#!    #EndTab
  #EndSheet
#!------------------------------------------------------------------------------
#atstart
#!  #IF(%DisablePlaceholder=0 and %DisableThisPlaceholder=0)
#!    #CALL(%AtStartInitialisation)
#!    #CALL(%AddObjectPR,%ClassName,%ObjectName,'Local Objects')
#!  #EndIf
#endat
#!------------------------------------------------------------------------------
#AT(%GatherSymbols),PRIORITY(2000),Where(%DisablePlaceholder=0)
  #CALL(%PlaceholderGatherSymbols2)
#ENDAT
#!------------------------------------------------------------------------------
#GROUP(%OverrideControlDescription),AUTO
  #EQUATE(%Desc, %OverrideControl)
  #IF(%OverrideControlBlocked)
    #SET(%Desc, %Desc &' - [BLOCKED]')
  #ELSIF(%OverrideControlText <> '')
    #SET(%Desc, %Desc &' - '& %OverrideControlText)
  #ENDIF
  #RETURN(%Desc)
#!------------------------------------------------------------------------------
#GROUP(%PlaceholderDeclareGlobalSymbols)#!NOT AUTO
  #DECLARE(%PlaceholderControl),MULTI
  #DECLARE(%PlaceholderControlText,%PlaceholderControl)
#!------------------------------------------------------------------------------
#GROUP(%PlaceholderGatherSymbols1)  #!GLOBAL sets up defaults
  #PURGE(%PlaceholderControl)
  #IF(NOT %PlaceholderOnlyWithLocal)
    #FOR(%Control),WHERE(%ControlNeedsPlaceholder())
      #ADD(%PlaceholderControl, %Control)
    #ENDFOR
  #ENDIF
#!------------------------------------------------------------------------------
#GROUP(%PlaceholderGatherSymbols2)  #!LOCAL has a chance to override global defaults
  #IF(%DisableThisPlaceholder)
    #PURGE(%PlaceholderControl)
  #ELSIF(%PlaceholderOnlyWithLocal)
    #FOR(%Control),WHERE(%ControlNeedsPlaceholder() AND (%AutoAddAllPlaceholders OR %IsOverrideControl()) AND NOT %IsOverrideControlBlocked())
      #ADD(%PlaceholderControl, %Control)
      #SET(%PlaceholderControlText,%FetchOverrideControlText())
    #ENDFOR
  #ENDIF
#!------------------------------------------------------------------------------
#GROUP(%PlaceholderGatherSymbols3)  #!GLOBAL does anything that's left
#!Blank for now
#!------------------------------------------------------------------------------
#GROUP(%ControlNeedsPlaceholder)
  #CASE(%ControlType)
  #OF('ENTRY')
  #!OROF('SPIN')
  #!OROF('COMBO')
    #RETURN(%True)
  #ELSE
    #RETURN(%False)
  #ENDCASE
#!------------------------------------------------------------------------------
#GROUP(%IsOverrideControl)
  #FIND(%OverrideControl,%Control,%OverrideControls)
  #RETURN(CHOOSE(INSTANCE(%OverrideControls)<>0,%True,%False))
#!------------------------------------------------------------------------------
#GROUP(%IsOverrideControlBlocked)
  #FIND(%OverrideControl,%Control,%OverrideControls)
  #RETURN(CHOOSE(INSTANCE(%OverrideControls)<>0,%OverrideControlBlocked,%False))
#!------------------------------------------------------------------------------
#GROUP(%FetchOverrideControlText)
  #FIND(%OverrideControl,%Control,%OverrideControls)
  #RETURN(CHOOSE(INSTANCE(%OverrideControls)<>0,%OverrideControlText,''))
#!------------------------------------------------------------------------------
#GROUP(%PlaceholderLocalObject)
    #IF(ITEMS(%PlaceholderControl))
#!#INSERT(%GenerateClassDeclaration,%ClassName,%ObjectName,'Local Objects','ClarionLive Objects')
%[20]('UltimatePlaceholder') UltimatePlaceholderWindowClass
    #ENDIF
#!------------------------------------------------------------------------------
#GROUP(%PlaceholderLocalMethods)
    #IF(ITEMS(%PlaceholderControl))
#!#INSERT(%GenerateMethods,%classname,%ObjectName,'Local Objects','ClarionLive Objects')
    #ENDIF
#!------------------------------------------------------------------------------
#GROUP(%PlaceholderLocalInitWindow, %pObjectName)
    #FOR(%PlaceholderControl)
      #IF(%PlaceholderControlText)
%pObjectName.AddControl(%PlaceholderControl, %PlaceholderControlText)
      #ELSE
%pObjectName.AddControl(%PlaceholderControl)
      #ENDIF
    #ENDFOR
#!------------------------------------------------------------------------------
